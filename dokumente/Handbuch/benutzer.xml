<?xml version="1.0" encoding="ISO-8859-15"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<chapter id="benutzerundrechteverwaltung" lang="de-DE" status="draft">
  <!-- $Id$ -->

  <chapterinfo>
    <releaseinfo>$Revision$</releaseinfo>

    <date>$Date$</date>
  </chapterinfo>

  <title>Benutzer- und Rechteverwaltung</title>

  <para>PostNuke verfügt über ein umfangreiches Benutzer- und
  Gruppenmanagement. Vor allem für die korrekte Anwendung des
  Berechtigungssystems ist ein Verständnis über die sich ergebenden
  Zusammenhänge sehr wichtig.</para>

  <section id="benutzerverwaltung">
    <title>Benutzerverwaltung<indexterm>
        <primary>Benutzerverwaltung</primary>
      </indexterm></title>

    <para>Üblicherweise registrieren Benutzer sich selbst und sind dann dem
    System bekannt. Über den Menüpunkt <menuchoice>
        <guimenu>Administration</guimenu>

        <guimenuitem>Benutzer-Administration</guimenuitem>
      </menuchoice> kann ein Systemverwalter aber auch selbst Benutzer
    anlegen. Dort befindet sich auch die Möglichkeit, bestehende Benutzer zu
    bearbeiten oder zu löschen. Im unteren Bereich befinden sich drei weitere
    Optionen:</para>

    <variablelist>
      <varlistentry>
        <term>Konfiguration Benutzerregistrierung</term>

        <listitem>
          <para>Hier werden bestimmte Parameter der Registrierung bearbeitet.
          Insbesondere ist es möglich, die Registrierung auch ganz
          abzuschalten (das ist immer dann sinnvoll, wenn der Benutzerkreis
          überschaubar ist und alle Benutzer vom Verwalter selbst angelegt
          werden). Bei der Altersabfrage bei der Registrierung handelt es sich
          um das sogenannte "COPPA-Agreement". Diese kann durch Setzen des
          Mindestalters auf 0 deaktiviert werden.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Benutzer-Konfiguration</term>

        <listitem>
          <para>Die Konfiguration dessen, was ein Anwender auf der Seite
          "Einstellungen" sieht.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>dynamische Benutzerdaten</term>

        <listitem>
          <para>Hier können eigene Felder für das Anwenderprofil erstellt
          werden. Diese müssen dann aber auch in den Sprachdateien
          entsprechend ergänzt werden.</para>
        </listitem>
      </varlistentry>
    </variablelist>

    <section id="mitgliederliste">
      <title>Mitgliederliste<indexterm>
          <primary>Mitgliederliste</primary>
        </indexterm></title>

      <para>Die Mitgliederliste zeigt eine alphabetische Auflistung aller
      registrierten Mitglieder.</para>

      <bridgehead>Zugriffsrechte<indexterm>
          <primary>Zugriffsrechte</primary>

          <secondary>Mitgliederliste</secondary>
        </indexterm></bridgehead>

      <para>Für das Modul Mitgliederliste gilt die Komponente 'Members_List::'
      wenn man z.B. den Zugriff auf die Mitgliederliste für unregistrierte
      Benutzer verhindern möchte, muss man ein (wichtig!) Benutzerrecht</para>

      <para><literal>unregistrierte | Members_List:: | .* |
      keines</literal></para>

      <para>anlegen. Es muss ein Benutzerrecht gewählt werden, da das
      allgemeine Leserecht bei den Gruppen (unregistrierte | .* | .* | lesen)
      ansonsten nicht überlagert werden kann.</para>
    </section>

    <section id="benutzeranmailen">
      <title>Benutzer anmailen<indexterm>
          <primary>Benutzer anmailen</primary>

          <seealso>Mailer</seealso>
        </indexterm></title>

      <para>Hier können gezielt einzelne User oder alle registrierten User
      angemailt werden.</para>

      <para>Entweder bei <emphasis>Benutzer anmailen</emphasis> aus der
      Dropdownliste einen der registrierten User auswählen oder das Feld
      <emphasis>alle registrierten Benutzer anmailen</emphasis>
      anwählen.</para>

      <para>In das Feld <emphasis>Absendername</emphasis> und in das Feld
      <emphasis>Absender Emailadresse</emphasis> werden die entsprechenden
      Daten eingetragen.</para>

      <para>Jetzt muß noch der <emphasis>Titel</emphasis> eingetragen werden,
      der dem Betreff entspricht. Nach dem Eintragen der
      <emphasis>Nachricht</emphasis> kann man über
      <emphasis>versenden</emphasis> die Nachricht abschicken.</para>
    </section>

    <section id="loginblock">
      <title>Der "User's Login"-Block<indexterm>
          <primary>Blöcke</primary>

          <secondary>Login</secondary>
        </indexterm></title>

      <para>Hiermit können sich registrierte Benutzer anmelden. Für noch nicht
      registrierte Benutzer steht ein Informationstext und ein Link zur
      Registrierung zur Verfügung.</para>

      <para>Wenn Sie dieser Block nicht aktiviert ist, kann man sich dennoch
      über <systemitem>&lt;PostNuke&gt;/user.php</systemitem> anmelden.</para>
    </section>

    <section id="onlineblock">
      <title>Der "Online"-Block<indexterm>
          <primary>Blöcke</primary>

          <secondary>Online</secondary>
        </indexterm></title>

      <para>Dieser Block zeigt an, wie viele Nutzer bzw. Gäste gerade online
      sind, unter welchem Namen man selbst angemeldet ist, und wie viele
      private Nachrichten man hat.</para>
    </section>

    <section id="custombox">
      <title>Der "User's Custom Box"-Block<indexterm>
          <primary>Blöcke</primary>

          <secondary>User's Custom Box</secondary>
        </indexterm></title>

      <para>Der Inhalt dieses Blocks kann vom Anwender selbst bestimmt werden
      (z.B. Lieblingslinks).</para>
    </section>
  </section>

  <section id="gruppenverwaltung">
    <title>Gruppenverwaltung<indexterm>
        <primary>Gruppenverwaltung</primary>
      </indexterm></title>

    <para>Die Gruppen dienen in PostNuke in erster Linie zur Verwaltung der
    Berechtigungen. In der Standard-Auslieferung von PostNuke gibt es zunächst
    drei Benutzergruppen:</para>

    <itemizedlist>
      <listitem>
        <para>unregistrierte</para>
      </listitem>

      <listitem>
        <para>Users</para>
      </listitem>

      <listitem>
        <para>Admins</para>
      </listitem>
    </itemizedlist>

    <para>Jeder Besucher ist zunächst einmal Mitglied der
    <emphasis>unregistrierten</emphasis> Benutzer, erst nach seiner Anmeldung
    (bzw. der Registrierung) ist er Mitglied der
    <emphasis>Users-Gruppe</emphasis>. Der Administrator der Seite wird
    bereits während der Installation der <emphasis>Admin-Gruppe</emphasis>
    zugewiesen. Diese System-Gruppen sollten weder umbenannt noch gelöscht
    werden! <note>
        <para>Bei Upgrades von älteren Version von PostNuke, PHPNuke oder
        myPHPNuke werden zusätzlich Gruppen gemäß den alten Autorenrechten
        eingerichtet, allerdings müssen die Rechte neu zugewiesen
        werden.<indexterm>
            <primary>Update</primary>
          </indexterm></para>
      </note>Zur individuellen Verwaltung kann man unter <menuchoice>
        <guimenu>Administration</guimenu>

        <guimenuitem>Gruppen</guimenuitem>
      </menuchoice> beliebig viele weitere Gruppen anlegen und ihnen Benutzer
    zuordnen. Ein Benutzer kann dabei auch mehreren Gruppen zugeordnet
    werden:</para>

    <variablelist>
      <varlistentry>
        <term>neue Gruppe hinzufügen</term>

        <listitem>
          <para>dient dazu weitere, individuelle Gruppen einzurichten, denen
          später Mitglieder zugewiesen werden können</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Gruppenname</term>

        <listitem>
          <para>listet die bereits bestehenden Gruppen auf, durch einen Klick
          auf den jeweiligen Namen kann man die Mitgliederliste dieser Gruppe
          aufrufen und editieren (Benutzer zu Gruppe hinzufügen | löschen |
          Gruppe modifizieren) Die Standardgruppen 'Admins' und 'Users'
          sollten nicht umbenannt oder gelöscht werden!</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section id="zugriffsrechte">
    <title>Zugriffsrechte (Permissions)<indexterm>
        <primary>Zugriffsrechte</primary>
      </indexterm></title>

    <para>Das Berechtigungssystem erlaubt Administratoren die Inhalte ihrer
    Seite zu schützen und den Zugang zu allen Bereich individuell
    einzustellen. Es unterscheidet neun unterschiedliche Stufen:</para>

    <orderedlist>
      <listitem>
        <para>keines</para>
      </listitem>

      <listitem>
        <para>Übersicht</para>
      </listitem>

      <listitem>
        <para>lesen</para>
      </listitem>

      <listitem>
        <para>kommentieren</para>
      </listitem>

      <listitem>
        <para>moderieren</para>
      </listitem>

      <listitem>
        <para>editieren</para>
      </listitem>

      <listitem>
        <para>hinzufügen</para>
      </listitem>

      <listitem>
        <para>löschen</para>
      </listitem>

      <listitem>
        <para>administrieren</para>
      </listitem>
    </orderedlist>

    <para>Die sich ergebenden Berechtigungen sind dabei modulspezifisch, d.h.
    <emphasis>der Modulautor entscheidet welche Berechtigung für eine
    bestimmte Aktion notwendig ist</emphasis>.</para>

    <para>Generell gilt, dass Berechtigungen kumulativ sind, d.h. alle
    niedriegeren Berechtigungen beinhalten ('kommentieren' schliesst also
    automatisch auch 'lesen' mit ein). Die Rechte werden nacheinander
    ausgewertet. Der erste Treffer zählt, alles weitere wird ignoriert.
    Zugriffsberechtigungen werden linear von oben nach unten in der Liste
    angewendet - PostNuke nimmt die erste passende Berechtigung und wendet
    diese an - wenn also eine Zeile Adminberechtigung einräumt kann dies nicht
    durch eine spätere Zeile eingeschränkt werden!</para>

    <para>Die <emphasis role="bold">Komponente<indexterm>
        <primary>Komponente</primary>

        <see>Zugriffsrechte</see>
      </indexterm></emphasis> ist vorgegeben, z.B. Menublock:: oder
    Onlineblock::.</para>

    <para>Die <emphasis role="bold">Instanz<indexterm>
        <primary>Instanz</primary>

        <see>Zugriffsrechte</see>
      </indexterm></emphasis> besteht aus zwei Teilen, deren Bedeutung von der
    jeweiligen Komponente abhängt. Die einzelnen Teile sind durch den
    Doppelpunkt voneinander getrennt. Der Ausdruck, der ausgewertet wird, ist
    ein regulärer Ausdruck. Damit mag der eine oder andere nichts anfangen,
    aber mal kurz:</para>

    <itemizedlist>
      <listitem>
        <para><command>*</command> steht für eine beliebige Wiederholung (auch
        keine)</para>
      </listitem>

      <listitem>
        <para><command>.</command> beschreibt ein beliebiges Zeichen</para>
      </listitem>

      <listitem>
        <para><command>^</command> steht für den Beginn, <command>$</command>
        für das Ende</para>
      </listitem>

      <listitem>
        <para>| ist eine Auswahl aus mehreren Möglichkeiten</para>
      </listitem>
    </itemizedlist>

    <para>Beispiele:</para>

    <variablelist>
      <varlistentry>
        <term><citation><command>^<replaceable>Haupt</replaceable>*</command></citation></term>

        <listitem>
          <para>Alles was mit "<replaceable>Haupt</replaceable>" beginnt, also
          <replaceable>Haupt</replaceable>menü,
          <replaceable>Haupt</replaceable>auswahl,
          <replaceable>Haupt</replaceable>mann.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><command>(<replaceable>x</replaceable>|<replaceable>y</replaceable>|<replaceable>z</replaceable>)</command></term>

        <listitem>
          <para><replaceable>x </replaceable>oder <replaceable>y</replaceable>
          oder <replaceable>z</replaceable> als Ganzes</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><command>.*</command></term>

        <listitem>
          <para>alles</para>
        </listitem>
      </varlistentry>
    </variablelist>

    <bridgehead>Vorgehensweise bei der Berechtigungsvergabe</bridgehead>

    <para>Zuerst sollte man eine Gruppe erstellen, für die die Berechtigungen
    gelten sollen und dann die Mitglieder zuordnen. Dieser Gruppe kann man im
    folgenden dann die gewünschten Berechtigungen zuweisen.</para>

    <para>Ein Beispiel: Erstellung einer Gruppe 'Subadmin', die News
    administrieren kann, Schritt für Schritt erklärt: Zuerst die Gruppe
    'Subadmin' anlegen und gewünschte Benutzer zuordnen. Dann unter
    Zugriffsrechte auf neues Gruppenrecht klicken.</para>

    <itemizedlist>
      <listitem>
        <para>Gruppe -&gt; Subadmin</para>
      </listitem>

      <listitem>
        <para>Komponente -&gt; Stories::Story</para>
      </listitem>

      <listitem>
        <para>Instanz -&gt; .*</para>
      </listitem>

      <listitem>
        <para>Zugriffsrecht -&gt; administrieren</para>
      </listitem>
    </itemizedlist>

    <para>(eine Liste der vorhandenen Komponenten wird übrigens bei Klick auf
    den Titel in einem Pop-Up-Fenster eingeblendet) Man beachte: diese
    Einstellung räumt der Gruppe Adminberechtigung für das Modul Stories ein!
    Jetzt muss man noch sicherstellen, dass die Reihenfolge der Berechtigungen
    korrekt ist. In den meisten Fällen ist die oberste Berechtigung:</para>

    <itemizedlist>
      <listitem>
        <para>Admins | .* | .* | administrieren</para>
      </listitem>
    </itemizedlist>

    <para>(also dürfen alle Benutzer in der Gruppe Admin alles) Die neu
    eingerichtete Subadmin-Gruppe sollte also UNTER diese Berechtigung
    gestellt werden, damit keine spätere Zeile eventuelle Einschränkungen
    vornimmt.</para>

    <para>Beispiel:</para>

    <itemizedlist>
      <listitem>
        <para>Subadmin|Stories::|.*|administrieren</para>
      </listitem>

      <listitem>
        <para>Users|.*|.*|kommentieren</para>
      </listitem>
    </itemizedlist>

    <para>erlaubt Mitglieder der Subadmin-Gruppe die Administration des
    Story-Bereiches - wenn man nun die beiden Zeilen in der Reihenfolge
    umstellt, macht die Berechtigung schon keinen Sinn mehr, da die Subadmins
    als Mitglieder der Gruppe 'Users' nur das Kommentarrecht eingeräumt
    bekommen. Durch den Einsatz der 'Instanz' in den Berechtigungen kann man
    die Einstellungen sehr detailliert einrichten - folgende Beispiele sollen
    dies verdeutlichen: Der Link zur 'Administration' im Hauptmenü soll nur
    für Administratoren angezeigt werden.</para>

    <itemizedlist>
      <listitem>
        <para>alle Gruppen|Menublock::|Hauptmenü:Administration:|keines</para>
      </listitem>
    </itemizedlist>

    <para>Dabei ist wichtig, dass das Hauptmenü auch tatsächlich 'Hauptmenü'
    heisst und dass diese Zugriffsberechtigung direkt UNTER denen der
    Admingruppen steht (in der default-Installation ist das eigentlich schon
    eingetragen - und zwar für das Main Menu) Wenn nun mehrer Links 'gesperrt'
    werden sollen, ist die Angabe wie folgt:</para>

    <itemizedlist>
      <listitem>
        <para>alle
        Gruppen|Menublock::|Hauptmenü:(Administration|Link1|Link2):|keines</para>
      </listitem>
    </itemizedlist>

    <para>(das | (Pipe-) Zeichen fungiert als Trenner der einzelnen mit
    Klammern umschlossenen Einträge) Sehr häufig wird gefragt, wie man
    anonymen Benutzern die Teilnahme an Umfragen bzw. das Kommentieren von
    Beiträgen ermöglichen kann:</para>

    <itemizedlist>
      <listitem>
        <para>unregistrierte Gruppen|Polls::|.*|kommentieren</para>
      </listitem>

      <listitem>
        <para>unregistrierte Gruppen|Stories::Story|.*|kommentieren</para>
      </listitem>
    </itemizedlist>

    <para>Diese Zeilen müssen natürlich ÜBER die normalerweise letzte Zeile in
    der die allgemeinen Rechte für anonyme Benutzer auf lesen gesetzt
    werden.</para>

    <warning>
      <para>Ein fehlerhaft konfiguriertes Berechtigungssystem kann dazu
      führen, dass z.B. anonyme Benutzer auf der PostNuke-Site Inhalte
      aktualisieren, hinzufügen oder sogar löschen können! Wenn man allerdings
      sorgfältig vorgeht und die bereits bestehenden Berechtigungen (und auch
      ihre Reihenfolge in der Liste) nicht ändert, sollte das allerdings nicht
      passieren... Wenn man sich trotz aller Warnungen einmal selber
      ausgesperrt hat, kann das PostNuke Swiss Army Knife Tool die
      Berechtigungen wieder auf den Standard zurücksetzen.<indexterm>
          <primary>Sicherheit</primary>
        </indexterm></para>
    </warning>

    <bridgehead>Benutzer oder Gruppenrechte?<indexterm>
        <primary>Zugriffsrechte</primary>

        <secondary>Gruppebnrechte</secondary>
      </indexterm><indexterm>
        <primary>Zugriffsrechte</primary>

        <secondary>Benutzerrechte</secondary>
      </indexterm><indexterm>
        <primary>Benutzerrechte</primary>

        <see>Zugriffsrechte</see>
      </indexterm><indexterm>
        <primary>Gruppenrechte</primary>

        <see>Zugriffsrechte</see>
      </indexterm></bridgehead>

    <para>Eines vorweg: die Rechte sind in beiden fällen die Gleichen.
    Einziger Unterschied besteht in der Rangfolge der Rechte:
    <emphasis>Benutzerrechte überschreiben immer
    Gruppenrechte</emphasis>.</para>

    <para>Gruppen-Rechte sollten generell festgelegt werden. Gruppenrechte
    beziehen sich auf alle Mitglieder einer Gruppe wohingegen Benutzerrechte
    sich auf einen speziellen Benutzer beziehen. Sie regeln eigentlich den
    grundsätzlichen Zugang zur Seite! Die Benutzerrechte legen die
    Freiheitsgrade des einzelnen Users fest.</para>

    <para>Normalerweise sollten Gruppenrechte eingesetzt werden und nur in
    Ausnahmefällen sollten Benutzerrechte zusätzlich gesetzt werden, damit ein
    spezieller Benutzer zusätzliche Rechte über seine Gruppenrechte hinaus
    erhält.</para>

    <para>Die Festlegung der einzelnen Benutzerrechte geht weiter und ist im
    Grunde detaillierter (insofern sie eben einen User betrifft und nicht eine
    Gruppe aus mehreren Usern).</para>

    <para>Deshalb sollten die Benutzerrechte auch erst nach den Gruppenrechten
    festgelegt werden; Sie bestimmen die Möglichkeiten, wenn ein bestimmter
    User etwas machen können sollte, was mit dem Rechtestatus seiner aktuellen
    Gruppenzugehörigkeit nicht möglich ist.</para>

    <para>Man sollte mit den Gruppenrechten zuerst arbeiten und später dann
    die Benutzerrechte zur Feinabstimmung hinzuziehen!</para>

    <note>
      <para>Möchte man die Anmeldung so handhaben, dass jeder Benutzer erst
      durch den Administrator freigeschaltet werden muss, so erreicht man das
      über die richtige Anwendung des Berechtigungssystems. In der
      Standard-Auslieferung dürfen</para>

      <itemizedlist>
        <listitem>
          <para>Anonyme lesen</para>
        </listitem>

        <listitem>
          <para>Registrierte kommentieren</para>
        </listitem>

        <listitem>
          <para>Admins administrieren</para>
        </listitem>
      </itemizedlist>

      <para>Wenn man das ganze restriktiver handhaben möchtest, sollte man die
      Rechte der beiden Gruppen 'Unregistrierte' und 'User' entsprechend
      runtersetzen und eine zusätzliche Gruppe 'Mitglieder' mit erweiterten
      Rechten einrichten. Die Mitgliedschaft in dieser Gruppe vergibt der
      Admin dann in der Gruppen-Administration.</para>
    </note>
  </section>
</chapter>